# Express RESTful API –∑ Passport —Ç–∞ —Å–µ—Å—ñ—è–º–∏

–°–µ—Ä–≤–µ—Ä –Ω–∞ **Node.js + Express**, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –∫–æ–º–ø–ª–µ–∫—Å–Ω—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **Passport.js** —Ç–∞ —Å–µ—Å—ñ–π. –ü—Ä–æ—î–∫—Ç –≤–∫–ª—é—á–∞—î HTML-—Å—Ç–æ—Ä—ñ–Ω–∫–∏, REST API, —à–∞–±–ª–æ–Ω—ñ–∑–∞—Ç–æ—Ä–∏ Pug/EJS, middleware –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó, –∞ —Ç–∞–∫–æ–∂ –∑—Ä—É—á–Ω–µ –¥–µ–º–æ-—Ç–µ–º—É–≤–∞–Ω–Ω—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.

## üìö –ó–º—ñ—Å—Ç
- [–û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ](#–æ—Å–Ω–æ–≤–Ω—ñ-–º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó](#—Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-—Ç–∞-–∑–∞–ø—É—Å–∫)
- [–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —Ç–∞ —Å–µ—Å—ñ—ó](#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è-—Ç–∞-—Å–µ—Å—ñ—ó)
- [–¢–µ–º–∏ —Ç–∞ cookies](#—Ç–µ–º–∏-—Ç–∞-cookies)
- [–ú–∞—Ä—à—Ä—É—Ç–∏](#–º–∞—Ä—à—Ä—É—Ç–∏)
- [–î–µ–º–æ-–∞–∫–∞—É–Ω—Ç–∏](#–¥–µ–º–æ-–∞–∫–∞—É–Ω—Ç–∏)

## ‚≠ê –û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ
- üîê **–õ–æ–∫–∞–ª—å–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è Passport (email + –ø–∞—Ä–æ–ª—å)**
- üîÑ **–°–µ—Å—ñ—ó —á–µ—Ä–µ–∑ express-session** –∑ httpOnly cookies
- üë§ **–ó–∞—Ö–∏—â–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏** (`/auth/profile`, `/protected`)
- üìù **Pug —Ç–∞ EJS —à–∞–±–ª–æ–Ω—ñ–∑–∞—Ç–æ—Ä–∏** –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç—É
- üß© **Middleware**: –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤, –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø—É, –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
- üé® **–°–≤—ñ—Ç–ª–∞/—Ç–µ–º–Ω–∞ —Ç–µ–º–∞** —á–µ—Ä–µ–∑ cookies

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó
- [Node.js](https://nodejs.org/)
- [Express.js](https://expressjs.com/)
- [Passport.js](https://www.passportjs.org/) –∑ –ª–æ–∫–∞–ª—å–Ω–æ—é —Å—Ç—Ä–∞—Ç–µ–≥—ñ—î—é
- [express-session](https://www.npmjs.com/package/express-session)
- [bcryptjs](https://www.npmjs.com/package/bcryptjs) –¥–ª—è —Ö–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤
- [Pug](https://pugjs.org/) —Ç–∞ [EJS](https://ejs.co/)
- [cookie-parser](https://www.npmjs.com/package/cookie-parser)

> ‚öôÔ∏è –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ Passport, Passport-Local —Ç–∞ Express-Session –ø–æ—Å—Ç–∞—á–∞—é—Ç—å—Å—è –∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `vendor/` —ñ –ø—ñ–¥–∫–ª—é—á–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ `file:` –ø–æ—Å–∏–ª–∞–Ω–Ω—è, —Ç–æ–º—É –≤–æ–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ –æ—Ñ–ª–∞–π–Ω.

## üöÄ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫
1. –ö–ª–æ–Ω—É–≤–∞—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:
   ```bash
   git clone <your-repository-url>
   cd fullstack_hw64.1
   ```

2. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:
   ```bash
   npm install
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä —É —Ä–µ–∂–∏–º—ñ —Ä–æ–∑—Ä–æ–±–∫–∏:
   ```bash
   npm run dev
   ```
   –∞–±–æ —É –ø—Ä–æ–¥–∞–∫—à–Ω-—Ä–µ–∂–∏–º—ñ:
   ```bash
   npm start
   ```

4. –í—ñ–¥–∫—Ä–∏—Ç–∏ –±—Ä–∞—É–∑–µ—Ä: [http://localhost:3000](http://localhost:3000)

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —Ç–∞ —Å–µ—Å—ñ—ó
### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Passport
- –õ–æ–∫–∞–ª—å–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **email** —Ç–∞ **–ø–∞—Ä–æ–ª—å**.
- –ü–∞—Ä–æ–ª—ñ —Ö–µ—à—É—é—Ç—å—Å—è `bcryptjs` —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ø–∞–º'—è—Ç—ñ (–¥–µ–º–æ-—Ä–µ–∂–∏–º).
- `passport.serializeUser` —Ç–∞ `passport.deserializeUser` –ø—Ä–∞—Ü—é—é—Ç—å —ñ–∑ –ø–∞–º'—è—Ç—Ç—é —Å–µ—Å—ñ–π.

### –°–µ—Å—ñ—ó
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `express-session` –∑ httpOnly cookies (`connect.sid`).
- –¢–µ—Ä–º—ñ–Ω –∂–∏—Ç—Ç—è cookie ‚Äî 7 –¥–Ω—ñ–≤ (–º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ —É `src/server.mjs`).
- –£ production `secure` –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–º–∏–∫–∞—î—Ç—å—Å—è.

### –ü–æ—Ç—ñ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø–æ–≤–Ω—é—î —Ñ–æ—Ä–º—É `/auth/register` –∞–±–æ `/auth/login`.
2. –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ Passport –≤–∏–∫–ª–∏–∫–∞—î `req.login` —ñ –∑–±–µ—Ä—ñ–≥–∞—î ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É —Å–µ—Å—ñ—ó.
3. –ü—ñ–¥ —á–∞—Å –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ `passport.session()` –≤—ñ–¥–Ω–æ–≤–ª—é—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –Ω–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∑–∞—Ö–∏—â–µ–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤.
4. –í–∏—Ö—ñ–¥ (`/auth/logout`) –æ—á–∏—â–∞—î —Å–µ—Å—ñ—é —Ç–∞ cookie.

## üé® –¢–µ–º–∏ —Ç–∞ cookies
- Cookie `theme` –∑–±–µ—Ä—ñ–≥–∞—î –≤–∏–±—ñ—Ä —Ç–µ–º–∏ (`light`/`dark`) –Ω–∞ 30 –¥–Ω—ñ–≤.
- HTTP API –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ç–µ–º–æ—é: `POST /api/theme/set`, `GET /api/theme/current`.
- Cookie —Å–µ—Å—ñ—ó (`connect.sid`) –º–∞—î –ø—Ä–∞–ø–æ—Ä `httpOnly` —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ª–∏—à–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.

## üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç–∏
### HTML-—Å—Ç–æ—Ä—ñ–Ω–∫–∏
| –ú–µ—Ç–æ–¥ | –®–ª—è—Ö            | –û–ø–∏—Å                                  |
|-------|-----------------|---------------------------------------|
| GET   | `/`             | –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑ –æ–ø–∏—Å–æ–º —Å–µ—Ä–≤—ñ—Å—É     |
| GET   | `/auth/login`   | –§–æ—Ä–º–∞ –≤—Ö–æ–¥—É (email + –ø–∞—Ä–æ–ª—å)          |
| GET   | `/auth/register`| –§–æ—Ä–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó                      |
| GET   | `/auth/profile` | –ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∑–∞—Ö–∏—â–µ–Ω–æ)        |
| GET   | `/protected`    | –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏–π –∑–∞—Ö–∏—â–µ–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç     |
| GET   | `/test`         | –°—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è UI            |

### REST API (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
| –ú–µ—Ç–æ–¥ | –®–ª—è—Ö             | –û–ø–∏—Å                                        |
|-------|------------------|---------------------------------------------|
| POST  | `/auth/register` | –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –∞–≤—Ç–æ–ª–æ–≥—ñ–Ω         |
| POST  | `/auth/login`    | –í—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (Passport Local)           |
| POST  | `/auth/logout`   | –í–∏—Ö—ñ–¥ —ñ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–µ—Å—ñ—ó                     |
| GET   | `/auth/me`       | –î–∞–Ω—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (JSON)           |
| GET   | `/protected`     | JSON-–≤—ñ–¥–ø–æ–≤—ñ–¥—å –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ |
| GET   | `/users/:userId` | –†–æ–±–æ—Ç–∞ –∑ –¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–¥–µ–º–æ)        |
| GET   | `/articles`      | –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω—ñ —Å—Ç–∞—Ç—Ç—ñ (EJS)                |

## üë§ –î–µ–º–æ-–∞–∫–∞—É–Ω—Ç–∏
| –†–æ–ª—å  | Email               | –ü–∞—Ä–æ–ª—å   |
|-------|---------------------|----------|
| Admin | `admin@example.com` | `admin123` |
| User  | `user@example.com`  | `user123`  |

> –ù–æ–≤—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—é—Ç—å—Å—è –¥–æ –¥–µ–º–æ-—Å—Ö–æ–≤–∏—â–∞ —Ç–∞ –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –≤—ñ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó.